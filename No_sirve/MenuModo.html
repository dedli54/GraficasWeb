<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="CSS/StyleMenuPrincipal.css">
    <title id="Title">MODO DE JUEGO</title>
</head>
<body>
    <form class="container" action="">
        <div class="logo">
            <img id="logo_juego" src="IMAGENES/TituloJuego.png">
        </div>
        
        <h1>MODO DE JUEGO</h1>
        <div class="buttons_menu">
            <a href="MenuSeleccion.html">
                <img class="imagen_button" src="IMAGENES/SINGLEPLAYER.png" alt="boton_verde">
            </a>
            <a href="#" id="buttonMultijugador">
                <img class="imagen_button" src="IMAGENES/Multijugador.png" alt="boton_verde">
            </a>
            <a href="index.html">
                <img class="imagen_button" src="IMAGENES/Salir.png" alt="boton_verde">
            </a>
        </div>

      
      
    </form>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script type="module">
        const buttonlogin = document.getElementById("buttonMultijugador");
        var currentuser;
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";
      
        // Your web app's Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyDH02J997ayPxyI_fBnUCjZfJVYoWEavaM",
          authDomain: "piagcw-53251.firebaseapp.com",
          databaseURL: "https://piagcw-53251-default-rtdb.firebaseio.com",
          projectId: "piagcw-53251",
          storageBucket: "piagcw-53251.appspot.com",
          messagingSenderId: "796665278678",
          appId: "1:796665278678:web:e8a42b970b2daa7353d977"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);
        const provider = new GoogleAuthProvider();

        buttonlogin.addEventListener("click", async function(){
            console.log('login');
            await signInWithPopup(auth, provider)
            .then((result) => {
            // This gives you a Google Access Token. You can use it to access the Google API.
            const credential = GoogleAuthProvider.credentialFromResult(result);
            const token = credential.accessToken;
            // The signed-in user info.
            currentuser = result.user;
            console.log('User signed in:', currentuser);
            // Store user information in localStorage
            localStorage.setItem('currentUser', JSON.stringify(currentuser));
            var status = "activo";
            var usuarioNuevo = writeUserData(currentuser.uid, currentuser.displayName, status,0, 0);
            if(usuarioNuevo == "success"){
                
                window.location.href = 'Multijugador.html';
        
            }   
            
            }).catch((error) => {
            // Handle Errors here.
            const errorCode = error.code;
            const errorMessage = error.message;
            console.error('Error during sign-in:', errorCode, errorMessage);
            // The email of the user's account used.
            const email = error.customData.email;
            // The AuthCredential type that was used.
            const credential = GoogleAuthProvider.credentialFromError(error);
            // ...
            });
        });

        const starCountRef = ref(database, 'users/');
        onValue(starCountRef, (snapshot) => {
            const data = snapshot.val();
            console.log(data);
        });

        function writeUserData(userId, name, status, x, z) {

            set(ref(database, 'users/' + userId), {
                name: name,
                status: status,
                x: x,
                z: z
            });
            return "success";
        }
      
      </script>
</body>
</html>
